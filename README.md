# The eye

"The Eye", a service that collects for further analysis user behavior generated by events in the client application, helping your organization to make better data-driven decisions.

### Motivation

System was developed during a practical test for ConsumerAffairs.
### Run project locally using Docker
#### Check list
```
- [ ] Install [Docker](https://docs.docker.com/engine/install/ubuntu/)
- [ ] Install [Docker Compose](https://docs.docker.com/compose/install/)
- [ ] Clone the project $ git clone (https://github.com/adbrum/the_eye.git)`
- [ ] $ cd the_eye
- [ ] Run setup.sh `sh setup.sh` or `./setup.sh`
- [ ] Create a super user in order to access the Django Admin
```

### Data model

There are three models: Event and Session. Each Event belongs to a Session.

### Serializers

Serializer is used for each model. In serializers.py there are examples of custom fields, dynamic fields, nested fields, and creating objects with nested fields.

### Permissions

Permissions were implemented with IsAuthenticated and TokenAuthentication, which allows reading and writing by accredited users.

### About the project

In order for the project to be simple and easy to maintain, I chose to use Python, Django and Django Rest Framework, aiming at the minimum waste of resources in the face of a considerable demand for accesses, on average ~100 events/second.

With the high demand for access, I chose to use Celery and REDIS, which do not handle them in real time, passing these to a queue of activities.

#### Example requests

- Authentication - POST `/api-token-auth/`

```
curl -X POST http://127.0.0.1:8000/api-token-auth/ \
 -H "Content-Type: application/json" \
 -d '{"username":"admin","password":"admin"}' \
 --user "username:password"
```

- Note - Copy the token to the specific field `Authorization: Token` in the session.

- Create a session - POST `/sessions/`

```
curl --location --request POST 'http://127.0.0.1:8000/sessions/' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token a85b7781eb826f93280cf4c4ee6c233a69a14ae3'
```

- Get session id - GET `/sessions/`

```
curl --location --request GET 'http://127.0.0.1:8000/sessions/' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token ae1abde65fd378088c5616c579fd5ae5060467ec'
```

- Note - Copy the token to the specific field `Authorization: Token` and the session id for the `session_id` field.

- Add an event - POST `/events/`

```
curl --location --request POST 'http://127.0.0.1:8000/events/' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token fcd298ad6589bf0d42c537d64b561c8d099e7966' \
--data-raw '{
      "session_id": "e2085be5-9137-4e4e-80b5-f1ffddc25423",
      "category": "page interaction",
      "name": "cta click",
      "data": {
      "host": "www.consumeraffairs.com",
      "path": "/",
    "element": "chat bubble"
    },
  "timestamp": "2021-01-01 09:15:27.243860"
}'
```

- List added events - GET `/events/`

```
curl --location --request GET 'http://127.0.0.1:8000/events/' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token ae1abde65fd378088c5616c579fd5ae5060467ec'
```

- Search for a specific event - GET `/event_detail/`

```
curl --location --request GET 'http://127.0.0.1:8000/event_detail/1' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token fcd298ad6589bf0d42c537d64b561c8d099e7966'
```

- Search for a specific category - GET `/events/?category=<category>`

```
curl --location --request GET 'http://127.0.0.1:8000/events/?category=page%20interaction' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token ae1abde65fd378088c5616c579fd5ae5060467ec'

```

- Search for a specific session id - GET `/events/?sessiond_id=<sessiond_id>`

```
curl --location --request GET 'http://127.0.0.1:8000/events/?session_id=97a7e388-4ca7-408b-a87f-0313075850c2' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token a85b7781eb826f93280cf4c4ee6c233a69a14ae3'
```

- Search for a specific name - GET `/events/?name=<name>`

```
curl --location --request GET 'http://127.0.0.1:8000/events/?name=pageview' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token a85b7781eb826f93280cf4c4ee6c233a69a14ae3'
```

- Search for a specific timestamp - GET `/events/?name=<name>`

```
curl --location --request GET 'http://127.0.0.1:8000/events/?timestamp=2021-11-12T12:30:06.902847Z' \
--header 'Content-Type: application/json' \
--header 'Authorization: Token a85b7781eb826f93280cf4c4ee6c233a69a14ae3'
```
